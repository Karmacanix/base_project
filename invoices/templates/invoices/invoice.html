{% extends "site-base.html" %}

{% load static %}
{% load account %}
{% load i18n %}
{% load mathfilters %}

{% block head_title %}{% trans "Invoice" %}{% endblock %}


{% block content %}
<div class="w3-container w3-margin-top">
	{% if invoice %}
    <header class="w3-container">
      <h1>{% trans "Invoice for project" %} {{p}}</h1>
    </header>
    <div class="w3-container w3-card-4">
      <br>
      <table class="w3-table-all w3-hoverable w3-grey">
        <thead>
          <tr class='w3-light-blue'>
            <th>Task</th>
            <th>Person</th>
            <th>Total Hours</th>
            <th>Hourly Rate</th>
            <th>Rate x hours</th>
          </tr>
        </thead>
        <tbody>
         {% for timesheet in invoice %}
            {% for line in timesheet_lines %}
              {% if timesheet.name == line.timesheet.name %}
                <tr>
                  {% with line.mon|addition:line.tue|addition:line.wed|addition:line.thu|addition:line.fri|addition:line.sat|addition:line.sun as line_hours %}
                  <td>{{ line.task }}</td>
                  <td>{{ timesheet.user }}</td>
                  <td>{{ line_hours }}</td>
                  {% for user in team %}
                    {% if timesheet.user == user.member %}
                      <td>${{ user.rate|floatformat:2 }}</td>
                      <td>$<span name="lp" id="lp-{{forloop.counter0}}">{{ line_hours|mul:user.rate|floatformat:2 }}</span></td>
                    {% endif %}
                  {% endfor %}
                  {% endwith %}
                </tr>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
      <br>
      <div class='w3-container w3-right-align'>
       <table>
          <tr>
            <td>subtotal</td>
            <td id="gross_total">$0.00</td>
          </tr>
          <tr>
            <td>GST 15%</td>
            <td id="gst">$0.00</td>
          </tr>
          <tr>
            <td>grand total</td>
            <td id="net_total">$0.00</td>
          </tr>
        </table>
      </div>
    </div>
  {% else %}
    <p>No invoices.</p>
  {% endif %}
</div>

{% block extra_body %}
<script>
Number.prototype.formatMoney = function(c, d, t){
    var n = this, 
    c = isNaN(c = Math.abs(c)) ? 2 : c, 
    d = d == undefined ? "." : d, 
    t = t == undefined ? "," : t, 
    s = n < 0 ? "-" : "", 
    i = String(parseInt(n = Math.abs(Number(n) || 0).toFixed(c))), 
    j = (j = i.length) > 3 ? j % 3 : 0;
   return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
 };
var x = document.getElementsByName("lp");
var subTotal = 0.00;
var i = 0;
for (i = 0; i < x.length; i++) {
  var line_price = parseFloat(document.getElementsByName("lp")[i].innerHTML);
  subTotal += line_price;
}
document.getElementById("gross_total").innerHTML = "$"+ subTotal.formatMoney(2);
var GST = subTotal*0.15
document.getElementById("gst").innerHTML = "$"+ GST.formatMoney(2);
var NET = GST+subTotal
document.getElementById("net_total").innerHTML = "$"+ NET.formatMoney(2);
</script>
{% endblock %}


{% endblock %}